<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>rateUS - –û—Ü–µ–Ω–∫–∞ —Ç–æ–≤–∞—Ä–∞ –∏ –∑–∞—è–≤–∫–∏</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Geologica:wght@400;700&display=swap");
    body {
      font-family: "Geologica", sans-serif;
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(to bottom, white 10%, #37a636 90%);
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }
    h1 {
      margin-top: 0;
      font-weight: 700;
      margin-bottom: 10px;
      font-size: 2.4rem;
      user-select: none;
    }
    /* --- –û—Ü–µ–Ω–∫–∞ —Ç–æ–≤–∞—Ä–∞ --- */
    #rating-section {
      background: rgba(255 255 255 / 0.9);
      border-radius: 12px;
      padding: 20px 25px 30px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 5px 20px rgb(0 0 0 / 0.1);
      margin-bottom: 40px;
    }
    #rating-section > p {
      font-size: 1.1rem;
      margin: 15px 0 10px;
      color: #222;
    }
    .buttons-row {
      display: flex;
      justify-content: space-around;
      margin: 20px 0 10px;
      gap: 10px;
    }
    button.rate-btn {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      border: none;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      color: white;
      box-shadow:
        0 3px 5px rgb(0 0 0 / 0.1);
    }
    button.rate-btn:hover:not(:disabled),
    button.rate-btn:focus-visible:not(:disabled) {
      outline: none;
      transform: scale(1.05);
      box-shadow:
        0 5px 15px rgb(0 0 0 / 0.15);
    }
    button.rate-btn:disabled {
      opacity: 0.5;
      cursor: default;
      transform: none;
    }
    /* –ö—Ä–∞—Å–Ω–∞—è */
    #btn-red {
      background-color: #b92b2b;
      color: #5a0f0f;
      font-family: "Geologica", sans-serif;
    }
    /* –ñ–µ–ª—Ç–∞—è */
    #btn-yellow {
      background-color: #f0ca3b;
      color: #735f15;
      font-family: "Geologica", sans-serif;
    }
    #btn-yellow p {
      writing-mode: vertical-lr;
      transform: rotate(180deg);
      margin: 0;
      font-size: 2rem;
      line-height: 0.7;
      user-select: none;
      font-weight: 900;
      letter-spacing: 0.15em;
    }
    /* –ó–µ–ª–µ–Ω–∞—è */
    #btn-green {
      background-color: #37a636;
      color: #0e590e;
      font-family: "Geologica", sans-serif;
    }
    #btn-green p {
      writing-mode: vertical-lr;
      margin: 0;
      font-size: 2rem;
      line-height: 0.7;
      user-select: none;
      font-weight: 900;
      letter-spacing: 0.15em;
    }
    /* –¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö */
    #btn-red span,
    #btn-yellow span,
    #btn-green span {
      margin-top: 8px;
      font-size: 14px;
      user-select: none;
      font-weight: 600;
    }

    /* –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ + –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å */
    #feedback-area {
      margin-top: 10px;
      display: none;
      flex-direction: column;
    }
    textarea {
      resize: vertical;
      min-height: 70px;
      font-family: "Geologica", sans-serif;
      font-size: 1rem;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1.5px solid #444;
      outline-offset: 2px;
      outline-color: transparent;
      transition: outline-color 0.3s ease;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 12px;
      background: #fff;
      color: #222;
    }
    textarea:focus {
      outline-color: #37a636;
    }
    #send-feedback-btn {
      align-self: flex-end;
      background-color: #1f4a0f;
      border: none;
      color: white;
      font-weight: 700;
      padding: 10px 24px;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.25s ease;
    }
    #send-feedback-btn:hover:not(:disabled),
    #send-feedback-btn:focus-visible:not(:disabled) {
      background-color: #2e6e12;
      outline: none;
    }
    #send-feedback-btn:disabled {
      opacity: 0.6;
      cursor: default;
    }
    /* –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤ */
    #thankyou-msg {
      margin-top: 12px;
      font-size: 1.15rem;
      font-weight: 700;
      color: #2f6d12;
      user-select: none;
    }
    /* --- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ --- */
    #app-section {
      background: rgba(255 255 255 / 0.95);
      box-shadow: 0 5px 20px rgb(0 0 0 / 0.1);
      max-width: 420px;
      width: 100%;
      border-radius: 12px;
      padding: 25px 25px 30px;
      box-sizing: border-box;
    }
    #app-section h2 {
      font-weight: 700;
      font-size: 2rem;
      margin-top: 0;
      user-select: none;
      margin-bottom: 20px;
      color: #37a636;
      text-align: center;
    }
    label {
      font-size: 1rem;
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
      user-select: none;
      color: #222;
    }
    select,
    input[type="text"] {
      width: 100%;
      border-radius: 6px;
      border: 1.5px solid #444;
      font-family: "Geologica", sans-serif;
      font-size: 1rem;
      padding: 8px 10px;
      margin-bottom: 18px;
      box-sizing: border-box;
      outline-offset: 2px;
      outline-color: transparent;
      transition: outline-color 0.3s ease;
    }
    select:focus,
    input[type="text"]:focus {
      outline-color: #37a636;
    }
    /* –ß–µ–∫–±–æ–∫—Å—ã —Å—Ç–∏–ª—å */
    .checkbox-group {
      margin-bottom: 24px;
      user-select: none;
    }
    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
      font-size: 1rem;
      color: #222;
      cursor: pointer;
      user-select: none;
    }
    .checkbox-group input[type="checkbox"] {
      /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —á–µ–∫–±–æ–∫—Å */
      appearance: none;
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid black;
      border-radius: 4px;
      outline: none;
      cursor: pointer;
      position: relative;
      transition: background-color 0.3s ease, border-color 0.3s ease;
      background-color: white;
    }
    .checkbox-group input[type="checkbox"]:checked {
      background-color: #37a636;
      border-color: #37a636;
    }
    .checkbox-group input[type="checkbox"]:checked::after {
      content: "";
      position: absolute;
      left: 6px;
      top: 2px;
      width: 6px;
      height: 12px;
      border: solid white;
      border-width: 0 3px 3px 0;
      transform: rotate(45deg);
    }
    /* –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ */
    #create-app-btn {
      width: 100%;
      background-color: #37a636;
      color: white;
      border: none;
      font-weight: 700;
      padding: 12px 0;
      font-size: 1.1rem;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.25s ease;
      margin-bottom: 10px;
    }
    #create-app-btn:hover:not(:disabled),
    #create-app-btn:focus-visible:not(:disabled) {
      background-color: #2d8530;
      outline: none;
    }
    #create-app-btn:disabled {
      opacity: 0.6;
      cursor: default;
    }
    /* –¢–µ–∫—Å—Ç —Å —Å—Å—ã–ª–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
    #created-link {
      font-size: 0.9rem;
      color: #222;
      word-break: break-all;
      margin-top: 12px;
      font-weight: 600;
      user-select: text;
    }
    /* –°–µ–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç–∑—ã–≤–æ–≤ */
    #reviews-section {
      background: rgba(255 255 255 / 0.95);
      max-width: 400px;
      width: 100%;
      border-radius: 12px;
      padding: 20px 20px 25px;
      box-sizing: border-box;
      box-shadow: 0 5px 20px rgb(0 0 0 / 0.1);
      margin-top: 30px;
      user-select: none;
    }
    #reviews-section h2 {
      margin-top: 0;
      font-weight: 700;
      font-size: 1.8rem;
      margin-bottom: 15px;
      color: #37a636;
      text-align: center;
    }
    #appIdInput {
      width: 100%;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1.5px solid #444;
      font-family: "Geologica", sans-serif;
      font-size: 1rem;
      margin-bottom: 12px;
      box-sizing: border-box;
      outline-offset: 2px;
      outline-color: transparent;
      transition: outline-color 0.3s ease;
    }
    #appIdInput:focus {
      outline-color: #37a636;
    }
    #loadReviewsBtn {
      width: 100%;
      background-color: #37a636;
      border: none;
      padding: 10px 0;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1rem;
      color: white;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.25s ease;
      margin-bottom: 12px;
    }
    #loadReviewsBtn:hover:not(:disabled),
    #loadReviewsBtn:focus-visible:not(:disabled) {
      background-color: #2d8530;
      outline: none;
    }
    #loadReviewsBtn:disabled {
      opacity: 0.6;
      cursor: default;
    }
    #reviewsList {
      max-height: 260px;
      overflow-y: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
      padding: 12px;
      font-size: 0.95rem;
      color: #222;
    }
    .review-item {
      padding: 8px 10px;
      border-bottom: 1px solid #ddd;
    }
    .review-item:last-child {
      border-bottom: none;
    }
    .review-rating {
      font-weight: 700;
      margin-bottom: 4px;
      user-select: none;
    }
    .review-text {
      white-space: pre-wrap;
      user-select: text;
    }
  </style>
</head>
<body>
  <section id="rating-section" aria-label="–û—Ü–µ–Ω–∫–∞ —Ç–æ–≤–∞—Ä–∞">
    <h1>–û—Ü–µ–Ω–∏—Ç–µ —Ç–æ–≤–∞—Ä</h1>
    <div class="buttons-row" role="radiogroup" aria-labelledby="rating-label">
      <button id="btn-red" class="rate-btn" aria-pressed="false" aria-label="–ù–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å" data-rating="red">
        <p style="font-size:3.8rem; line-height:0.8; user-select:none;">üò†</p>
        <span>–ù–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å</span>
      </button>
      <button id="btn-yellow" class="rate-btn" aria-pressed="false" aria-label="–ù–µ –æ—á–µ–Ω—å" data-rating="yellow">
        <p>:(</p>
        <span>–ù–µ –æ—á–µ–Ω—å</span>
      </button>
      <button id="btn-green" class="rate-btn" aria-pressed="false" aria-label="–ü–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å" data-rating="green">
        <p>:)</p>
        <span>–ü–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å</span>
      </button>
    </div>
    <div id="feedback-area" aria-live="polite">
      <label id="feedback-label" for="feedback-text"></label>
      <textarea id="feedback-text" rows="4" placeholder="" aria-describedby="feedback-label"></textarea>
      <button id="send-feedback-btn" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
    </div>
    <p id="thankyou-msg" role="alert" style="display:none;">–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤!</p>
  </section>

  <section id="app-section" aria-label="–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –≤ rateUS">
    <h2>rateUS</h2>
    <label for="type-select">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</label>
    <select id="type-select" aria-required="true">
      <option value="" disabled selected>–ü—Ä–æ–¥—É–∫—Ç –∏–ª–∏ —É—Å–ª—É–≥–∞</option>
      <option value="product">–ü—Ä–æ–¥—É–∫—Ç</option>
      <option value="service">–£—Å–ª—É–≥–∞</option>
    </select>

    <label for="app-name">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
    <input type="text" id="app-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" aria-required="true" />

    <div class="checkbox-group" role="group" aria-label="–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞—è–≤–∫–∏">
      <label><input type="checkbox" id="check-feature1" /> –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å 1</label>
      <label><input type="checkbox" id="check-feature2" /> –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å 2</label>
      <label><input type="checkbox" id="check-feature3" /> –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å 3</label>
    </div>

    <button id="create-app-btn" disabled>–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
    <div id="created-link" aria-live="polite"></div>
  </section>

  <section id="reviews-section" aria-label="–û—Ç–∑—ã–≤—ã –ø–æ –∑–∞—è–≤–∫–µ">
    <h2>–û—Ç–∑—ã–≤—ã –ø–æ –∑–∞—è–≤–∫–µ</h2>
    <input type="text" id="appIdInput" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∑–∞—è–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: id1234)" />
    <button id="loadReviewsBtn" disabled>–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç–∑—ã–≤—ã</button>
    <div id="reviewsList" aria-live="polite" role="list"></div>
  </section>

  <script type="module">
    // Firebase SDK v9 modular import
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-analytics.js";
    import { getDatabase, ref, push, set, onValue, get } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-database.js";

    // Firebase configuration from user
    const firebaseConfig = {
      apiKey: "AIzaSyBnAVJ5m6zmRpWgNPfSUo1V36Qv_f-NiW0",
      authDomain: "rateus-2d2dc.firebaseapp.com",
      databaseURL: "https://rateus-2d2dc-default-rtdb.firebaseio.com",
      projectId: "rateus-2d2dc",
      storageBucket: "rateus-2d2dc.firebasestorage.app",
      messagingSenderId: "437127558019",
      appId: "1:437127558019:web:72c644fee8cd7b0f4e3cb6",
      measurementId: "G-WJ9E0Z7DM5"
    };

    // Initialize Firebase & services
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);

    // --- Rate Section ---
    const btnRed = document.getElementById("btn-red");
    const btnYellow = document.getElementById("btn-yellow");
    const btnGreen = document.getElementById("btn-green");
    const feedbackArea = document.getElementById("feedback-area");
    const feedbackLabel = document.getElementById("feedback-label");
    const feedbackText = document.getElementById("feedback-text");
    const sendFeedbackBtn = document.getElementById("send-feedback-btn");
    const thankyouMsg = document.getElementById("thankyou-msg");

    let selectedRating = null;
    let currentAppId = null; // will store last created app id for association

    function resetRatingButtons() {
      [btnRed, btnYellow, btnGreen].forEach(btn => {
        btn.setAttribute("aria-pressed", "false");
      });
    }

    function setButtonSelected(btn) {
      resetRatingButtons();
      btn.setAttribute("aria-pressed", "true");
    }

    // When rating selected, show feedback area with proper label and placeholder
    function updateFeedbackArea(rating) {
      let labelText = "";
      let placeholder = "";
      switch (rating) {
        case "green":
          labelText = "–ù–∞–ø–∏—à–∏—Ç–µ, —á–µ–º –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è —Ç–æ–≤–∞—Ä (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)";
          placeholder = "–í–∞—à –æ—Ç–∑—ã–≤...";
          break;
        case "yellow":
          labelText = "–û–ø–∏—à–∏—Ç–µ, —á–µ–º –≤–∞–º –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è —Ç–æ–≤–∞—Ä... (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)";
          placeholder = "–í–∞—à –æ—Ç–∑—ã–≤...";
          break;
        case "red":
          labelText = "–û–ø–∏—à–∏—Ç–µ, —á–µ–º –≤–∞–º –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è —Ç–æ–≤–∞—Ä –∏ —á—Ç–æ –Ω–∞–º –±—ã —Å–ª–µ–¥–æ–≤–∞–ª–æ —É–ª—É—á—à–∏—Ç—å... (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)";
          placeholder = "–í–∞—à –æ—Ç–∑—ã–≤...";
          break;
      }
      feedbackLabel.textContent = labelText;
      feedbackText.placeholder = placeholder;
      feedbackText.value = "";
      sendFeedbackBtn.disabled = false;
      thankyouMsg.style.display = "none";
      feedbackArea.style.display = "flex";
      feedbackText.focus();
    }

    // Click handlers for rating buttons
    [btnRed, btnYellow, btnGreen].forEach((btn) => {
      btn.addEventListener("click", () => {
        selectedRating = btn.dataset.rating;
        setButtonSelected(btn);
        updateFeedbackArea(selectedRating);
      });
    });

    // Send review function (Save review to Firebase DB)
    sendFeedbackBtn.addEventListener("click", async () => {
      if (!selectedRating) return;
      if (!currentAppId) {
        alert("–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤.");
        return;
      }
      sendFeedbackBtn.disabled = true;
      const feedback = feedbackText.value.trim();
      const reviewData = {
        rating: selectedRating,
        feedback: feedback,
        timestamp: Date.now(),
      };
      try {
        // Save review under /reviews/{appId}
        const reviewsRef = ref(db, `reviews/${currentAppId}`);
        await push(reviewsRef, reviewData);
        thankyouMsg.style.display = "block";
        // Reset rating selection & feedback
        selectedRating = null;
        resetRatingButtons();
        feedbackArea.style.display = "none";
        feedbackText.value = "";
      } catch (e) {
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–∑—ã–≤–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
        sendFeedbackBtn.disabled = false;
        return;
      }
      sendFeedbackBtn.disabled = false;
    });

    // --- Create Application Section ---
    const typeSelect = document.getElementById("type-select");
    const appNameInput = document.getElementById("app-name");
    const createAppBtn = document.getElementById("create-app-btn");
    const createdLink = document.getElementById("created-link");

    // Enable button only if type & name filled
    function updateCreateAppBtnState() {
      createAppBtn.disabled = !(typeSelect.value && appNameInput.value.trim());
    }
    typeSelect.addEventListener("change", updateCreateAppBtnState);
    appNameInput.addEventListener("input", updateCreateAppBtnState);

    createAppBtn.addEventListener("click", async () => {
      if (!typeSelect.value || !appNameInput.value.trim()) return;
      createAppBtn.disabled = true;
      createdLink.textContent = "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏...";
      // Collect checked features
      const features = [];
      document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(chk => {
        if (chk.checked) features.push(chk.nextSibling.textContent.trim());
      });
      const appData = {
        type: typeSelect.value,
        name: appNameInput.value.trim(),
        features,
        createdAt: Date.now(),
      };
      try {
        // Save application data to /apps/ (push new id)
        const appsRef = ref(db, "apps");
        const newAppRef = await push(appsRef);
        await set(newAppRef, appData);
        const newAppId = newAppRef.key;
        // Show generated link (domen/id)
        createdLink.textContent = `${location.origin}/${newAppId}`;
        currentAppId = newAppId;

        // Reset form fields
        typeSelect.value = "";
        appNameInput.value = "";
        document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(chk => chk.checked = false);
        updateCreateAppBtnState();
      } catch (e) {
        createdLink.textContent = "–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
      }
      createAppBtn.disabled = false;
    });

    // --- Load reviews section ---
    const appIdInput = document.getElementById("appIdInput");
    const loadReviewsBtn = document.getElementById("loadReviewsBtn");
    const reviewsList = document.getElementById("reviewsList");

    // Enable "load reviews" if input not empty
    appIdInput.addEventListener("input", () => {
      loadReviewsBtn.disabled = !appIdInput.value.trim();
      reviewsList.innerHTML = "";
    });

    loadReviewsBtn.addEventListener("click", async () => {
      const id = appIdInput.value.trim();
      if (!id) return;
      reviewsList.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞...";
      loadReviewsBtn.disabled = true;

      try {
        const reviewsRef = ref(db, `reviews/${id}`);
        const snapshot = await get(reviewsRef);
        if (!snapshot.exists()) {
          reviewsList.textContent = "–û—Ç–∑—ã–≤—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.";
          loadReviewsBtn.disabled = false;
          return;
        }
        const data = snapshot.val();
        const html = Object.entries(data)
          .sort(([, a], [, b]) => b.timestamp - a.timestamp)
          .map(([, review]) => {
            // human-readable date
            let ratingText = {
              green: "–ü–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å",
              yellow: "–ù–µ –æ—á–µ–Ω—å",
              red: "–ù–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å"
            }[review.rating] || review.rating;
            let feedbackText = review.feedback || "(–±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤)";
            return `<div class="review-item" role="listitem">
              <div class="review-rating">–û—Ü–µ–Ω–∫–∞: ${ratingText}</div>
              <div class="review-text">${escapeHTML(feedbackText)}</div>
            </div>`;
          })
          .join("");
        reviewsList.innerHTML = html;
      } catch (e) {
        reviewsList.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤.";
      }
      loadReviewsBtn.disabled = false;
    });

    // Escape HTML helper to prevent XSS in feedback display
    function escapeHTML(str) {
      if (!str) return "";
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }
  </script>
</body>
</html>
